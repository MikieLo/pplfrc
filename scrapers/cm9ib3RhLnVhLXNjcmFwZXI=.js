"use strict";chrome.runtime.onMessage.addListener(((e,r,t)=>{if("PF_CHANNEL"===e.action)return void t({isLoaded:!0});if("PF_SCRAPE"!==e.action)return;const n=()=>{const e=(e=>{const r=document.cookie.match(new RegExp(`^${e}=(.*?);`))||document.cookie.match(new RegExp(` ${e}=(.*?);`));return r&&r[1]})("jwt-token");if(!e)return Promise.resolve([void 0,void 0]);let r;if(document.querySelector("lib-employer-applies-apply-widget-desktop")){const t=new URLSearchParams(window.location.search).get("id");r=fetch(`${window.location.protocol}//dracula.${window.location.hostname}/?q=GetResume`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({operationName:"GetResume",query:"query GetResume($id: ID!) {\n apply(id: $id) {\n resume {\n... on ApplyProfResume {\n downloadFileUrl\n}\n... on ApplyAttachResume {\n downloadFileUrl\n}\n}\n}\n}",variables:{id:t}})}).then((e=>e.json())).then((r=>fetch(r.data.apply.resume.downloadFileUrl,{method:"GET",headers:{Authorization:`Bearer ${e}`}})))}else{const t=window.location.pathname.split("/"),n=t[t.length-1];if(Number.isNaN(parseInt(n,10)))return Promise.resolve([void 0,void 0]);r=fetch(`${window.location.protocol}//employer-api.${window.location.hostname}/resume/file`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({cvId:n,openContacts:!1})})}return r.then((e=>{const r=document.querySelector("lib-applies-resume-main-info h2, lib-resume-main-info h1").innerText;return e.blob().then((e=>new Promise((t=>{const n=new FileReader;n.onload=()=>{const e=n.result;t([e,`${r}.rtf`])},n.readAsDataURL(e)}))))}))};try{const e=document.querySelector("lib-applies-resume-main-info h2, lib-resume-main-info h1"),r=document.querySelector('lib-applies-resume-main-info a[href^="mailto"], alliance-employer-resume-contacts a[href^="mailto"]'),o=document.querySelectorAll('lib-applies-resume-main-info a[href^="tel"], alliance-employer-resume-contacts a[href^="tel"]');let i=[];o&&(i=Array.from(o).map((e=>e.innerText.replace(/[^+\d]/g,""))).filter(Boolean));const a=document.querySelector('lib-applies-resume-main-info p[class="skype"], alliance-employer-resume-contacts p[class="skype"]'),s=document.querySelector('lib-applies-resume-main-info alliance-employer-resume-circle-photo img:not([src*="non-photo"]), lib-resume-main-info alliance-employer-resume-circle-photo img:not([src*="non-photo"])'),l=document.querySelector("lib-applies-resume-main-info div.santa-typo-additional, lib-resume-main-info h1 ~ p:last-of-type"),c=document.querySelector("alliance-employer-resume-brief-info > div p");let u;const m=document.querySelector("alliance-employer-resume-brief-info");if(m){const e=document.evaluate(".//span[contains(., 'грн')]",m).iterateNext();u=e&&parseInt(e.innerText.replace(/[^\d]/g,""),10)}let d;const p=document.querySelector("alliance-shared-ui-prof-resume-experience h3 > span");if(p){const e=p.innerText.match(/^(?<sex>.+?)\sв.*$/);if(e){const{sex:r}=e.groups;switch(r){case"Работал":case"Працював":d="male";break;case"Работала":case"Працювала":d="female";break;default:throw new Error(`Not supported gender <${r}>`)}}}const h=[],y=document.querySelector("alliance-shared-ui-prof-resume-skill-summary h3 ~ div");y&&h.push(y.innerHTML.replace(/(\r\n|\n|\r)/g,"<br>"));const f=document.querySelectorAll("alliance-shared-ui-prof-resume-additional h3 ~ div");f&&f.forEach((e=>{const r=e.querySelector("h4");for(;r.attributes.length;)r.removeAttribute(r.attributes[0].name);h.push(r.outerHTML),h.push(e.querySelector("div").innerHTML.replace(/(\r\n|\n|\r)/g,"<br>"))}));const v=document.querySelectorAll("alliance-shared-ui-prof-resume-experience > section > div:not(:first-child)"),S=Array.from(v).filter((e=>e.querySelector("h4").innerText)).map((e=>{const r=e.querySelector("h4").innerText,t=e.querySelector("h4 ~ div > div p:first-of-type").innerText,[n,o]=e.querySelector("h4 ~ div > div:nth-child(2) p:nth-of-type(2)").innerText.split(/\s-\s/),[i,a]=n.split("."),s=`${a}-${i}-01`;let l;if(!/по\sнастоящее\sвремя/.test(o)){const[e,r]=o.split(".");l=`${r}-${e}-01`}const c=e.querySelector("h4 ~ div > div:nth-child(2) > div > div:nth-child(2)");return{title:r,company:t,startsOn:s,endsOn:l,description:c&&c.innerText}})),b=document.querySelectorAll("alliance-shared-ui-prof-resume-education > section > div"),q=Array.from(b).filter((e=>e.querySelector("h4").innerText)).map((e=>{const r=e.querySelector("h4").innerText,t=e.querySelector("h4 ~ div > div");let n,o=e.querySelector("h4 ~ div > div:nth-child(2)");o?n=t.innerText:o=t;const[i,a]=o.innerText.split(/,\s(?!.*,\s)/);return{school:r,name:"—",subject:n,fromYear:a,toYear:a,description:i}})),x={full_name:e&&e.innerText,email:r&&r.innerText,gender:d,phone_numbers:i,skype:a&&a.innerText,photo_url:s&&s.src,position:l&&l.innerText,location:c&&c.innerText,source_url:null,urls:[document.location.href],salary:u,salary_currency:"UAH",resume_text:h.join("<br>"),resume_data:void 0,resume_filename:void 0};return n().then((([e,r])=>{x.resume_data=e,x.resume_filename=r,t([x,S,q])})).catch((e=>{t({message:e.message,stack:e.stack})})),!0}catch(e){t({message:e.message,stack:e.stack})}}));
//# sourceMappingURL=cm9ib3RhLnVhLXNjcmFwZXI=.js.map